# GitHub Actions 工作流说明

## 🔄 工作流概述

GitHub Actions 是 GitHub 提供的 CI/CD（持续集成/持续部署）服务，可以在代码变更时自动执行测试、构建和部署等任务。

## 📋 当前工作流的作用

### 🚀 **触发时机**

- 当代码推送到 `main` 或 `develop` 分支时
- 当有 Pull Request 提交到 `main` 分支时

### 🔧 **三个主要任务**

#### 1. **Test Job（测试任务）**

**目的**: 确保代码在不同 Node.js 版本下都能正常运行

**执行内容**:

- ✅ 在 Node.js 16.x、18.x、20.x 三个版本下测试
- ✅ 安装项目依赖
- ✅ 创建必要的目录和环境变量
- ✅ 启动应用并测试 API 接口
- ✅ 检查安全漏洞（高级别）

**测试的 API 接口**:

- `GET /` - 主页接口
- `GET /verify-mail` - 邮件配置验证
- `GET /mail-stats` - 邮件统计信息

#### 2. **Build Job（构建任务）**

**目的**: 构建生产环境的 Docker 镜像

**执行内容**:

- ✅ 只有测试通过后才会执行
- ✅ 安装生产环境依赖
- ✅ 构建 Docker 镜像
- ✅ 测试 Docker 镜像是否能正常运行

#### 3. **Security Job（安全检查任务）**

**目的**: 检查项目安全性

**执行内容**:

- ✅ 运行 npm 安全审计
- ✅ 检查过时的依赖包
- ✅ 扫描代码中的潜在敏感信息

## 🎯 **实际效果**

### ✅ **优势**

1. **自动化测试** - 每次代码提交都会自动测试
2. **多版本兼容** - 确保代码在不同 Node.js 版本下都能运行
3. **Docker 验证** - 确保 Docker 镜像可以正常构建和运行
4. **安全检查** - 及时发现安全漏洞和敏感信息
5. **质量保证** - 防止有问题的代码被合并到主分支

### 🔍 **监控内容**

- 代码语法是否正确
- 依赖包是否完整
- API 接口是否正常响应
- Docker 镜像是否能正常运行
- 是否存在安全漏洞
- 是否有敏感信息泄露

## 📊 **工作流状态**

在 GitHub 仓库中，您可以看到：

- ✅ 绿色勾 - 工作流通过
- ❌ 红色叉 - 工作流失败
- 🟡 黄色圆 - 工作流正在运行

## 🛠 **如何查看结果**

1. 进入 GitHub 仓库页面
2. 点击 "Actions" 标签
3. 选择对应的工作流运行记录
4. 查看详细的执行日志和结果

## 🔧 **自定义配置**

如果需要修改工作流，编辑 `.github/workflows/ci.yml` 文件：

```yaml
# 修改触发分支
on:
  push:
    branches: [main, develop, feature/*]

# 修改测试的Node.js版本
strategy:
  matrix:
    node-version: [16.x, 18.x, 20.x]

# 添加更多测试步骤
- name: 自定义测试
  run: npm run custom-test
```

## 📝 **注意事项**

1. **环境变量** - 工作流中使用测试用的环境变量，不会使用真实的邮件配置
2. **Docker 测试** - 会构建和测试 Docker 镜像，确保容器化部署没有问题
3. **安全扫描** - 会检查代码中是否有硬编码的密码或密钥
4. **失败处理** - 任何一个步骤失败都会导致整个工作流失败

这个工作流确保了代码质量和项目的稳定性，是现代软件开发的最佳实践！
